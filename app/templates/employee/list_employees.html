{% extends 'base.html' %}

{% block content %}
<div class="container-fluid mt-3 mb-5 font-corp">

  <!-- HEADER & TOOLBAR -->
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
    <div>
      <h4 class="fw-bold text-dark mb-1">Master Data Personil</h4>
      <p class="text-muted small mb-0">Database lengkap seluruh karyawan, status, dan biodata.</p>
    </div>
    
    <div class="d-flex gap-2 mt-3 mt-md-0">
      <!-- Fitur Pencarian Cepat (JavaScript) -->
      <div class="input-group" style="max-width: 300px;">
        <span class="input-group-text bg-white border-end-0"><i class="bi bi-search text-muted"></i></span>
        <input type="text" id="tableSearch" class="form-control border-start-0 ps-0" placeholder="Cari Nama, Posisi, atau Client...">
      </div>

      <a href="{{ url_for('employee_input_bp.add_employee') }}" class="btn btn-primary shadow-sm">
        <i class="bi bi-person-plus-fill me-2"></i>Registrasi Baru
      </a>
    </div>
  </div>

  <!-- CARD TABLE -->
  <div class="card card-corp border-top-primary shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0" id="employeeTable">
          <thead class="bg-light text-secondary small text-uppercase">
            <tr>
              <th class="ps-4 py-3" style="width:50px;">No</th>
              <th class="py-3">Nama Lengkap</th> <!-- Ditambah Avatar -->
              <th class="py-3">Posisi / Jabatan</th>
              <th class="py-3">Penempatan (Client)</th>
              <th class="py-3">Gender</th>
              <th class="py-3">Pendidikan</th>
              <th class="py-3">Status</th> <!-- Kolom Baru (Status) -->
              <th class="py-3 text-center" style="width:150px;">Aksi</th>
            </tr>
          </thead>
          <tbody class="border-top-0">
            {% if employees %}
              {% for emp in employees %}
              <tr>
                <td class="ps-4 text-center text-muted fw-bold">{{ loop.index }}</td>
                
                <!-- Nama + Avatar -->
                <td>
                  <div class="d-flex align-items-center">
                    <img src="{{ url_for('static', filename='uploads/' ~ (emp.photo or 'default_user.png')) }}" 
                         class="rounded-circle me-3 border" 
                         width="36" height="36" style="object-fit: cover;"
                         onerror="this.src='{{ url_for('static', filename='img/default_user.png') }}'">
                    <div>
                      <div class="fw-bold text-dark">{{ emp.personal_detail.full_name or emp.name }}</div>
                      <small class="text-muted" style="font-size: 0.75rem;">NIK: {{ emp.personal_detail.nik or '-' }}</small>
                    </div>
                  </div>
                </td>

                <td class="text-secondary fw-medium">{{ emp.position or '-' }}</td>
                
                <td>
                  {% if emp.client %}
                    <span class="badge bg-light text-dark border fw-normal">
                      <i class="bi bi-building me-1"></i> {{ emp.client.name }}
                    </span>
                  {% else %}
                    <span class="text-muted small">-</span>
                  {% endif %}
                </td>

                <td>{{ emp.personal_detail.gender or '-' }}</td>
                <td>{{ emp.personal_detail.education or '-' }}</td>
                
                <!-- Status Badge -->
                <td>
                  {% if emp.status == 'aktif' %}
                    <span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3">Aktif</span>
                  {% elif emp.status == 'standby' %}
                    <span class="badge bg-warning-subtle text-warning border border-warning-subtle rounded-pill px-3">Standby</span>
                  {% else %}
                    <span class="badge bg-secondary-subtle text-secondary border border-secondary-subtle rounded-pill px-3">Non-Aktif</span>
                  {% endif %}
                </td>

                <td class="text-center">
                  <div class="btn-group btn-group-sm shadow-sm">
                    <!-- Detail -->
                    <a href="{{ url_for('employee_input_bp.view_employee', emp_id=emp.id) }}" 
                       class="btn btn-light border text-primary" title="Lihat Detail">
                      <i class="bi bi-eye-fill"></i>
                    </a>
                    <!-- Edit -->
                    <a href="{{ url_for('hr.edit_employee', id=emp.id) }}" 
                       class="btn btn-light border text-warning" title="Edit Data">
                      <i class="bi bi-pencil-square"></i>
                    </a>
                    <!-- Hapus (Form) -->
                    <form action="{{ url_for('hr.delete_employee', id=emp.id) }}" method="POST" class="d-inline" onsubmit="return confirm('PERINGATAN SISTEM:\n\nApakah Anda yakin ingin menghapus data {{ emp.name }}?\nTindakan ini tidak dapat dibatalkan.');">
                      <button type="submit" class="btn btn-light border text-danger rounded-end" title="Hapus Data">
                        <i class="bi bi-trash-fill"></i>
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="8" class="text-center py-5">
                  <div class="text-muted">
                    <i class="bi bi-folder-x fs-1 d-block mb-2"></i>
                    Belum ada data karyawan yang tersimpan dalam database.
                  </div>
                </td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Footer Table (Total Data) -->
    <div class="card-footer bg-white py-3 border-top">
      <div class="d-flex justify-content-between align-items-center small text-muted">
        <div>Menampilkan total <span class="fw-bold text-dark">{{ employees|length }}</span> data personil.</div>
        <div>
          <!-- Placeholder Pagination (Visual Only) -->
          <nav aria-label="Page navigation">
            <ul class="pagination pagination-sm mb-0">
              <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
              <li class="page-item active"><a class="page-link" href="#">1</a></li>
              <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- SCRIPT PENCARIAN TABEL (Client Side) -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const searchInput = document.getElementById('tableSearch');
  const table = document.getElementById('employeeTable');
  const tr = table.getElementsByTagName('tr');

  searchInput.addEventListener('keyup', function() {
    const filter = searchInput.value.toLowerCase();
    
    // Loop semua baris tabel (mulai dari index 1 karena 0 adalah header)
    for (let i = 1; i < tr.length; i++) {
      let tdName = tr[i].getElementsByTagName("td")[1]; // Kolom Nama
      let tdPos  = tr[i].getElementsByTagName("td")[2]; // Kolom Posisi
      let tdClient = tr[i].getElementsByTagName("td")[3]; // Kolom Client
      
      if (tdName || tdPos || tdClient) {
        let txtName = tdName.textContent || tdName.innerText;
        let txtPos = tdPos.textContent || tdPos.innerText;
        let txtClient = tdClient.textContent || tdClient.innerText;
        
        if (txtName.toLowerCase().indexOf(filter) > -1 || 
            txtPos.toLowerCase().indexOf(filter) > -1 || 
            txtClient.toLowerCase().indexOf(filter) > -1) {
          tr[i].style.display = "";
        } else {
          tr[i].style.display = "none";
        }
      }
    }
  });
});
</script>

<!-- Style Tambahan -->
<style>
  .font-corp { font-family: 'Plus Jakarta Sans', sans-serif; }
  
  .card-corp {
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    background: #fff;
  }
  .border-top-primary { border-top: 4px solid #1e3a8a; }
  
  /* Table Hover Effect */
  .table-hover tbody tr:hover {
    background-color: #f8fafc;
  }
  
  /* Button Group Styling */
  .btn-group .btn {
    padding: 0.25rem 0.5rem;
  }
</style>
{% endblock %}